# **Инструкция к _Linux-Ubuntu_ на основании лекционного материала и семинарских занятий**

## Введение

В данном документе будут указаны все используемые команды в курсе лекций по операционной системе _Linux (Ubuntu)_.

Для простоты описания команд будут использованы следующие значения:

1. Имя пользователя - **db**;
2. Имя компьютера - **gb-linux**.

## Лекция 1:

Установка пакетов в Ubuntu.

    sudo apt update - обновить список пакетов;

    sudo apt install mc - установить пакет mc. 

MC (midnight commander) - Один из файловых менеджеров с текстовым интерфейсом типа Norton Commander для UNIX-подобных перационных систем. Вызвать менеджер можно с помощью команды:

_**mc**_

Выход с помощью команды:

_**exit**_

Очистка консоли : 

_**clear**_ или сочетание клавиш Ctrl + l


    sudo apt install openssh-server - удалённое подключение к машине через SSH соединение.

Команда, позволяющая узнать IP адрес машины:

_**ip a**_

Нас интересует адрес для соединения 2 _enp0s3_. Адрес представлен после слова *inet*

Проверка статуса SSH-соединения

    systemctl status ssh

Команда запуска SSH / автозагрузки SSH

   sudo systemctl start ssh / sudo systemctl enable ssh

### Подключение SSH-соединения с основной системой

1) При проводном подключении интернета:

- в настройках виртуальной машины найти вкладку "Сеть";
- тип подключения - сетевой мост, имя - _выбран сетевой адаптер_;
- запустить систему в виртуалной машине, в терминале узнать IP;
- открыть терминал на основной машине (PowerShell в моем случае) и прописать команду:

    ssh db@_ip адрес_

Можно работать с виртуальной машиной через терминал основной системы.

2) Беспроводное соединение:

- в настройках виртуальной машины, во вкладке "Сеть", тип подключения - NAT;
- открыть дополнительные свойства и выбрать _проброс портов_;
- кликнуть **добавить правило проброса портов**. Далее:
    1) Имя - любое;
    2) Протокол - ТСР;
    3) Адрес хоста и адрес гостя - пустое поле;
    4) Порт хоста ***8022***, порт гостя ***22***.
 - запустить систему на виртуальной машине;
 - открыть терминал на основной машине и прописать команду:

    ssh -p 8022 db@localhost

Соединение создано!


**Установка пакетов** позволяющих автоматическую адаптацию экрана отображения системы под экран работы с виртуальной машиной:

    sudo apt install perl gcc make

Далее, во вкладке "Устройства" выбираем пункт "подключить образ диска Дополнения гостевой ОС", далее кликнуть по иконке диска из графичекого интерфейса. Запустить в открывшейся папке документ _autorun.sh_ (правкая конка, "Запустить как программу"), вводим пароль.

Перезагружаем систему.

### Создание общей папки для обмена файлами с основной системой

В разделе устройства - общий буфер обмена - выбрать _двунаправленный_. 

В разделе устройства - общие папки - настроить - добавить новую папку - указываем путь к папке в основной системе - любое название - добавить опции _Авто-подключение_ и _Создать постоянную папку_ - В поле точка подключения указать адрес в виртуальной системе (пример, /home/db/shared). Данная папка имеет ограниченный доступ.

В терминале виртуальной машины ввести команду:
 
    sudo usermod -aG vboxsf db

Перезагрузить виртуальную машину.

## Семинар 1

Информация о системе через терминал

Вывести имя ОС

    uname

Вывести имя ОС с подробностями
    
    uname -a

Запросить имя хоста (машины)

    hostnamectl

Вывести инфо о дистрибутиве 

    lsb_release -a

IP адрес машины

    hostname -I

## Лекция 2

Знакомство с текстовыми редакторами

Команда перехода между директориями:

    cd /home  - переход (change directory) в директорию home

Команда перехода к "суперпользователю"

    sudo su

Просмотр списка файлов в директории (list)

    ls -al 

Параметр "а" в запросе - показывает скрытые файлы, начинающиеся с "."

Параметр "i" в запросе - показывает айноды

Если после команды "ls" прописать точный адрес, то может вывести перечень файлов требуемого места

Команда распечатывания/склейка/создание содержимого файла в терминал:

    cat [имя файла] - печать на экран

    cat > [имя файла] - создаёт пустой файл в директории. Далее следует возможность ввести информацию в файл и с помощью Ctrl + d информация сохраняется и происходит возврат в нормальную работу терминала

    cat >> [имя файла] - внесение правок в файл.

    cat [имя файла1] [имя файла2] > [имя файла3] - склеивает файл1 и файл2 в файл3

Команда показывает текущую директорию (Print working directory)

    pwd

Создание каталога (make directory). Рекомендавано работать в домашнем каталоге

    mkdir [название директории]

    mkdir -p 1/2/3/4/5 - создаёт директории от 1 до 5 вложенные друг в друге (5 в 4, 4 в 3 и т.д. до 1 каталога)

Копирование (copy)

    cp [имя файла исх.] [имя файла копии] - создаёт копию файла

    cp -r [название директории исх.] [имя директории копии] - создание копии директории

Копирование текста с помощью клавиатуры Ctrl + Shift + c

Удаление (remove)

    rm [имя файла]

    rm -f [имя файла] - без дополнительных вопросов

    rm -r [имя каталога] - удаление каталога

    rm * - удалить все файлы в директории

Переименование / перенос (move)

    mv [название директории исх.] [имя директории копии] 

    - если файлы находятся в одной файловой системе (один раздел жесткого диска, например), то произойдет переименование файла;
    - в противном случае будет произведён перенос (копирование + удаление !!!).

Создание пустого файла

    touch [имя файла]

    touch [имя существующего файла] - обновится дата изменения файла

Команда (manual), позволяющая получить подробную информацию о команде:

    man [название команды] 

Создание жесткой ссылки

    ln [имя исходного файла] [имя зависимого файла]

Создание символической ссылки

    ln -s [имя исходного файла] [имя зависимого файла]


### Текстовые редакторы

__*Vim*__

Установка 

    sudo apt install vim

Открыть документ в редакторе

    vim [название файла]

Инструкция по работе с vim

    vimtutor

1) Командный режим (навигация по файлу, копирование и вставку, удаление символов и строк, поиск текста)

    Esc

2) Режим редактирования (ввод и редактирование текста как в обычных редакторах) 

    I, A, O, Insert

3) Режим последней строки (сохранение файла (w), выход из редактора (q), выход без сохранения (q!) изменение настроек (set))

    :


__*Nano*__

К сведению: 

- запуск через команду __nano__;
- символ ^ обозначает Ctrl;
- буква М обозначает Alt.

Справка

    Ctrl + G

Сохранение файла

    Ctrl + O

Выход

    Ctrl + X

Включение номеров строк

    Alt + N

Поиск

    Ctrl + W

__*Mcedit*__

Аналогично по устройству с midnight commander. Запуск через команду __mcedit__.

Справка F1

Сохранение файла F2

Выход F10

Включение номеров строк Alt + N

и так далее.

### Пейджеры less и more 

Через команду __less__. *H* помогает освоить основы использования

More - более старая версия. 

### Head и tail

Head - просмотр n-количества строчек от начала файла.

    head -n 10 [имя файла]

Tail - просмотр n-количества строчек от окончания файла.

    tail -n 10 [имя файла]

    tail -f /var/log/auth.log - команда позволяет следить за изменениями файла. Ctrl + C прервать работу команды.

## Cеминар 2

Вывод текста в терминале

    echo [требуемый текст] / echo '[требуемый текст при наличии спец символов]'

    echo > [имя файла] - создание нового файла

    echo [требуемый текст] > [имя файла] - создание файла с текстом

Быстро удаление текста

    Ctrl + U - стирает текст слева от курсора

    Ctrl + K - стирает текст справа от курсора

Перезапуск терминала

    reset

История используемых команд

    history

Установка дополнения позволяющего просматривать наполнение директорий в виде схемы-дерево    

    sudo apt install tree

    tree

## Лекция 3

Права доступа и пользователи

Просмотр пользователей системы

    cat passwd -  в директории /etс

Просмотр групп

    cat group - в директории /etс

Просмотр паролей

    sudo cat shadow - в директории /etс

### Управление пользователями

Создание пользователя

    sudo useradd -s /bin/bash -m -d /home/testuser testuser - создание пользователя testuser

    -s /bin/bash - это установка оболочки bin bash

    -m - создание домашней директории

    -d [адрес директории] - адрес, где создаёт директория нового пользователя

Создание пользователя с помощью скрипта

    sudo adduser [имя_пользователя]

Автоматически создаётся новая группа, домашний каталог, копирование файлов.

Замена пароля

    passwd - замена для текущего пользователя

    sudo passwd [имя пользователя] - замена пароля для произвольного пользователя

Редактирование пользователя

    sudo usermod -aG adm testuser - добавление пользователя testuser в группу adm

    sudo usermod -g www-data testuser - перенос пользователя в группу www-data

    id - информация о пользователе / sudo id [имя пользователя] - информация о другом пользователе

Удаление пользователя

    sudo userdel [имя_пользователя]

Управление параметрами пользователя

    sudo chage [имя пользователя]

Создание и удаление групп

    sudo groupadd [имя группы] / sudo groupdel testgroup

### Механизм sudo и su

Переключение между пользователями 

    su [имя пользоввателя]

Если в условиях работы под другим, не админским, пользователем набрать команду "exit" то система выведет нас в управление главного пользователя

Переключение на суперпользователя

    sudo su

Описание редактирования возможного в записи лекции или в текстовом варианте. Лектором предложено не вносить существенных изменений именно в часть, касающуюся этих команд, так существует большая вероятность ошибки.

### Изменение владельца и группы владельца файлов

Замена пользователя и группы для файла

    sudo chown [новый обладатель прав]:[новая группа] [имя файла]

    sudo chown -R  [новый обладатель прав]:[новая группа] [имя каталога] - замена пользователя и группы для всех файлов каталога

    sudo chgrp -R [новая группа] [имя каталога] - замена группы для всех файлов каталога

### Изменение прав доступа

    chmod - команда для изменения прав (change mode)

    chmod -R [имя_директории] - изменение рекурсивно, для всех файлов директории.

    chmod u=rwx,g=rw,o=rx [имя файла] - пример изменения прав доступа для файла. U - users, для владельца. G - group, для группы пользователей. О - others, для остальных. Символьная форма, так будет выглядеть " -rwxrw-r-x "

    chmod 664 [имя файла] - пример изменения прав доступа для файла. Числовая форма, так будет выглядеть " -rw-rw-r-- "

Достаточно большая часть с кодировкой прав доступа. При необходимости - разобрать подробно!

## Семинар 3

2. Управление группами:

b) попрактиковаться в смене групп у пользователей;
c) добавить пользователя в группу, не меняя основной;


3. Работа с группами.

Удаление пользователя из группы

    sudo deluser [имя пользователя] [название группы]

Установка прав доступа по умолчанию

    umask [числовой код набора прав]

, все созданные далее файлы будут иметь строго данный набор прав

СЛОЖНАЯ ТЕМА !!! Далее выдержка из семинара от преподавателя. Под редакцию!!! 

Информация о пользователе

    whoami

В каких группах состоит текущий пользователь

    groups

Создание пользователя

    sudo useradd -m -s /bin/bash user1

Определяем пароль для пользователя

    sudo passwd user1

Параметры будут даны пользователю после создания по умолчанию

    useradd -D

Зайдём в оболочку под другим пользователем

    su user1

Проверим

    whoami

Выйти из сессии этого пользователя

    exit

удаление пользователя

    whatis userdel
    userdel -- help
    userdel -fr user1

заблокировать пользователя

    sudo usermod –L user1

разблокировать пользователя

    sudo usermod –U user1

дать пользователю права суперпользователя (root), добавив его в группу "sudo"

    sudo usermod -G sudo user1

переключимся в режим суперпользователя

    sudo su
	В строке приглашения знак $ изменился на #

убедимся, что мы работаем под суперпользователем

    whoami

в данном режиме не требуется для привилегированных операций каждый раз набирать префикс sudo

    apt update

выйдем из этого режима

    exit

в обычном режиме (без привилегий) команду обновления репозиториев надо выполнять с префиксом 

    sudo, иначе получим ошибку нехватки прав
    apt update
    sudo apt update

создать пользователя отдельно без пароля

    sudo useradd -m -d /home/user2 -s /bin/bash user2

зададим пароль пользователю

    sudo passwd user1

зайдем из-под него

    su user1

убедимся, что мы работаем под новым пользователем

    whoami

заглянем в файлик passwd

    more /etc/passwd

можно отфильтровать по имени пользователя

    more /etc/passwd | grep ^user

список групп

    more /etc/group

пароли (их хэши)

    more /etc/shadow

удалим с ключом  –f (force, принудительно)

    sudo userdel –f user9

создадим группу dev_team

    groupadd dev_team

проверим

    more /etc/group | grep dev

добавим в группу участника команды разработки (user11)

    sudo usermod -G dev_team user11


Права доступа

Команда chmod
Предоставить другим пользователям права на запись в файл header.txt

    chmod o+w header.txt

Можно менять несколько прав для ряда категорий

    chmod go-rw header.txt

Другие варианты работы с правами
    
    chmod u+w,g+r header.txt
    chmod -rw header.txt
    chmod u=rwx,g=wr,o=r header.txt

задание прав триадами цифр

•	0: (000) No permission.
•	1: (001) Execute permission.
•	2: (010) Write permission.
•	3: (011) Write and execute permissions.
•	4: (100) Read permission.
•	5: (101) Read and execute permissions.
•	6: (110) Read and write permissions.
•	7: (111) Read, write, and execute permissions.

    chmod 770 header.txt
ключ -R для задания рекурсивного изменения прав

    chmod 777 -R ~/lesson3

Изменяем владельца файла

    sudo chown user1 header.txt
 
Sticky bit нужен для запрета удаления файлов всем, кроме владельца

    chmod +t filename

установить флаг SUID

    chmod u+s filename

снять флаг SUID

    chmod u-s filename

установить флаг SGID 

    chmod g+s filename

снять флаг SGID

    chmod g-s filename

Смена владельца

Команда chown
Изменяет владельцев файла или папки, а также группу владельцев

сменим владельца файла f1

    sudo chown user2 f1

сменим группу владельцев 

    sudo chown :dev_team f1

сменим одновременно владельца и группу владельцев

    sudo chown student:student –R .

## Лекция 4

Установка пакетов и создание репозиториев

Добавление репозитория в основной файл

    /etc/apt/sources.list

Добавление файла с адресом репозитория

    /etc/apt/sources/list.d/*.list

    deb http://[адрес_репозитория] [версия дистрибутива ветки]

    deb htts://nginx.org/packages/ubuntu jammy nginx

Добавление ключа репозитория

    sudo apt-key add repo.key

### Утилита apt

Поиск пакета по названию и описанию

    apt search package_name

Поиск пакета по имени

    apt list package_name

Посмотреть информацию о пакете

    apt show package_name

Установить пакет

    apt install package_name -y

- y - убирает функцию подтверждения действия

Удалить пакет, при этом сохраняются файлы с настройками

    apt remove package_name

Полностью удалить пакет, включая конфигурационные файлы

    apt purge package_name

Обновить все установленные пакеты

    apt upgrade

Обновить информацию о пакетах в репозиториях, указанных в настройках

    apt update

### Утилита dpkg

Просмотр списка пакетов

    dpkg -l

Установить пакет или группу пакетов

    dpkg -i package_name

Удалить пакет или группу пакетов

    dpkg -r package_name

В лекции приведён пример установки пакета VirtualBox с помощью утилиты dpkg -i. После установки выявилось большое количество ошибок, которые исправляется командой:

    apt -f install

Выполняется автоматический поиск недостающих пакетов и установка VirtualBox.

### Snap-пакеты

Поиск пакета

    snap search package_name

Установка пакета

    snap install package_name

Обновление пакета

    snap refresh package_name

Удаление пакета

    snap remove package_name

Просмотр установленных пакетов

    snap list

### Планировщик cron

Утилита crontab

Вывести содержимое текущего файла расписания

    crontab -l

Удаление текущего расписания

    crontab -r

Редактирование текущего расписания

    crontab -e

Работа с файлом расписания другого пользователя

    sudo crontab -u username

## Семинар 4

Создание нового репозитория

    apt -add -repository


